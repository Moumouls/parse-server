"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.validateUpdate = exports.validateSetUp = exports.validateLogin = exports.policy = exports.getOrigin = exports.challenge = void 0;
var _server = require("@simplewebauthn/server");
var _node = _interopRequireDefault(require("parse/node"));
var _jsonwebtoken = require("jsonwebtoken");
var _crypto = _interopRequireDefault(require("crypto"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); } /**
 * WebAuthn Adapter can be used as an alternative way to login
 * Since we cannot support currently signup with webauthn will throw an error (due to lack of reset process)
 * User need to be logged in to setup the webauthn provider
 */
const toUserFriendlyRpName = url => {
  const domain = getDomainWithoutWww(url);
  const baseDomain = getBaseDomain(domain).split('.')[0];
  const words = baseDomain.split('-');
  return words.reduce((acc, word) => `${acc} ${word.charAt(0).toUpperCase() + word.slice(1)}`, '').trim();
};
const getJwtSecret = config => {
  const hash = _crypto.default.createHash('sha512');
  hash.update(config.masterKey, 'utf-8');
  // Security:
  // sha512 return 128 chars, we can keep only 64 chars since it represent 6,61E98 combinations
  // using the hash allow to reduce risk of compromising the master key
  // if brute force is attempted on the JWT
  return hash.digest().toString('hex').slice(64);
};

// Example here: https://regex101.com/r/wN6cZ7/365
const getDomainWithoutWww = url => /^(?:https?:\/\/)?(?:[^@\/\n]+@)?(?:www\.)?([^:\/?\n]+)/g.exec(url)[1];
const getBaseDomain = domain => {
  const splittedDomain = domain.split('.');
  // Handle localhost
  if (splittedDomain.length === 1) return domain.trim();
  // Classic domains
  return `${splittedDomain[splittedDomain.length - 2]}.${splittedDomain[splittedDomain.length - 1]}`.trim();
};
const getOrigin = config => getBaseDomain(getDomainWithoutWww(config.publicServerURL || config.serverURL));
exports.getOrigin = getOrigin;
const extractSignedChallenge = (signedChallenge, config) => {
  if (!signedChallenge) throw new _node.default.Error(_node.default.Error.OTHER_CAUSE, 'signedChallenge is required.');
  let expectedChallenge;
  try {
    expectedChallenge = (0, _jsonwebtoken.verify)(signedChallenge, getJwtSecret(config)).challenge;
    if (!expectedChallenge) throw new Error();
    return expectedChallenge;
  } catch (e) {
    throw new _node.default.Error(_node.default.Error.OTHER_CAUSE, 'Invalid signedChallenge');
  }
};

// Return credentials options to the client
// for register public key process
const registerOptions = (user, options = {}, config) => {
  const registrationOptions = (0, _server.generateRegistrationOptions)({
    rpName: options && options.rpName || toUserFriendlyRpName(config.publicServerURL || config.serverURL),
    rpID: options.rpId || getOrigin(config),
    // here userId is only used as an identifier and this is never
    // retrieved by the user device
    // this has not real value for parse
    userID: user.id,
    // Could be an email or a firstname lastname depending of
    // the developer usage
    userDisplayName: typeof options.getUserDisplayName === 'function' ? options.getUserDisplayName(user) : user.get('email') || user.get('username'),
    userName: typeof options.getUsername === 'function' ? options.getUsername(user) : user.get('username'),
    timeout: 60000,
    attestationType: options.attestationType || 'indirect',
    authenticatorSelection: {
      // Use required to avoid silent sign up
      userVerification: options.userVerification || 'required',
      residentKey: options.residentKey || 'preferred'
    }
  });
  return {
    // Use jwt signed challenge to avoid storing challenge in DB
    // Master key is considered safe here to sign the challenge
    // Add additional 20sec for a bad network latency
    signedChallenge: (0, _jsonwebtoken.sign)({
      challenge: registrationOptions.challenge
    }, getJwtSecret(config), {
      expiresIn: registrationOptions.timeout + 20000
    }),
    options: registrationOptions
  };
};

// Verify the registration provided by the client
const verifyRegister = async ({
  signedChallenge,
  registration
}, options = {}, config) => {
  if (!registration) throw new _node.default.Error(_node.default.Error.OTHER_CAUSE, 'registration is required.');
  const expectedChallenge = extractSignedChallenge(signedChallenge, config);
  try {
    const {
      verified,
      registrationInfo
    } = await (0, _server.verifyRegistrationResponse)({
      response: registration,
      expectedChallenge,
      requireUserVerification: options.userVerification === 'required' || !options.userVerification ? true : false,
      expectedOrigin: options.origin || getOrigin(config),
      expectedRPID: options.rpId || getOrigin(config)
    });
    if (verified) {
      return {
        counter: registrationInfo.counter,
        publicKey: registrationInfo.credentialPublicKey.toString('base64'),
        id: registration.id
      };
    }
    /* istanbul ignore next: fail safe */
    throw new Error();
  } catch (e) {
    throw new _node.default.Error(_node.default.Error.OTHER_CAUSE, 'Invalid webauthn registration');
  }
};
const loginOptions = config => {
  const options = (0, _server.generateAuthenticationOptions)();
  return {
    options,
    signedChallenge: (0, _jsonwebtoken.sign)({
      challenge: options.challenge
    }, getJwtSecret(config), {
      expiresIn: options.timeout + 20000
    })
  };
};
const verifyLogin = async ({
  authentication,
  signedChallenge
}, options = {}, config, user) => {
  const dbAuthData = user && user.get('authData') && user.get('authData').webauthn;
  if (!authentication) throw new _node.default.Error(_node.default.Error.OTHER_CAUSE, 'authentication is required.');
  const expectedChallenge = extractSignedChallenge(signedChallenge, config);
  try {
    const {
      verified,
      authenticationInfo
    } = await (0, _server.verifyAuthenticationResponse)({
      response: authentication,
      requireUserVerification: options.userVerification === 'required' || !options.userVerification ? true : false,
      expectedChallenge,
      expectedOrigin: options.origin || getOrigin(config),
      expectedRPID: options.rpId || getOrigin(config),
      authenticator: {
        credentialID: Buffer.from(dbAuthData.id, 'base64'),
        counter: dbAuthData.counter,
        credentialPublicKey: Buffer.from(dbAuthData.publicKey, 'base64')
      }
    });
    if (verified) {
      return _objectSpread(_objectSpread({}, dbAuthData), {}, {
        counter: authenticationInfo.newCounter
      });
    }
    /* istanbul ignore next: fail safe */
    throw new Error();
  } catch (e) {
    throw new _node.default.Error(_node.default.Error.OTHER_CAUSE, 'Invalid webauthn authentication');
  }
};
const challenge = async (challengeData, authData, adapterConfig = {}, request) => {
  // Allow logged user to update/setUp webauthn
  if (request.user && request.user.id) {
    return registerOptions(request.user, adapterConfig.options, request.config);
  }
  return loginOptions(request.config);
};
exports.challenge = challenge;
const validateSetUp = async (authData, adapterConfig = {}, request) => {
  if (!request.user && !request.master) throw new _node.default.Error(_node.default.Error.OTHER_CAUSE, 'Webauthn can only be configured on an already logged in user.');
  return {
    save: await verifyRegister(authData, adapterConfig.options, request.config)
  };
};
exports.validateSetUp = validateSetUp;
const validateUpdate = exports.validateUpdate = validateSetUp;
const validateLogin = async (authData, adapterConfig = {}, request) => {
  if (!request.original) throw new _node.default.Error(_node.default.Error.OTHER_CAUSE, 'User not found for webauthn login.');
  // Will save updated counter of the credential
  // and avoid cloned/bugged authenticators
  return {
    save: await verifyLogin(authData, adapterConfig.options, request.config, request.original)
  };
};
exports.validateLogin = validateLogin;
const policy = exports.policy = 'solo';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc2VydmVyIiwicmVxdWlyZSIsIl9ub2RlIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9qc29ud2VidG9rZW4iLCJfY3J5cHRvIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJvd25LZXlzIiwiZSIsInIiLCJ0IiwiT2JqZWN0Iiwia2V5cyIsImdldE93blByb3BlcnR5U3ltYm9scyIsIm8iLCJmaWx0ZXIiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwicHVzaCIsImFwcGx5IiwiX29iamVjdFNwcmVhZCIsImFyZ3VtZW50cyIsImxlbmd0aCIsImZvckVhY2giLCJfZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIiwiZGVmaW5lUHJvcGVydGllcyIsImRlZmluZVByb3BlcnR5Iiwia2V5IiwidmFsdWUiLCJfdG9Qcm9wZXJ0eUtleSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiaSIsIl90b1ByaW1pdGl2ZSIsIlN5bWJvbCIsInRvUHJpbWl0aXZlIiwiY2FsbCIsIlR5cGVFcnJvciIsIlN0cmluZyIsIk51bWJlciIsInRvVXNlckZyaWVuZGx5UnBOYW1lIiwidXJsIiwiZG9tYWluIiwiZ2V0RG9tYWluV2l0aG91dFd3dyIsImJhc2VEb21haW4iLCJnZXRCYXNlRG9tYWluIiwic3BsaXQiLCJ3b3JkcyIsInJlZHVjZSIsImFjYyIsIndvcmQiLCJjaGFyQXQiLCJ0b1VwcGVyQ2FzZSIsInNsaWNlIiwidHJpbSIsImdldEp3dFNlY3JldCIsImNvbmZpZyIsImhhc2giLCJjcnlwdG8iLCJjcmVhdGVIYXNoIiwidXBkYXRlIiwibWFzdGVyS2V5IiwiZGlnZXN0IiwidG9TdHJpbmciLCJleGVjIiwic3BsaXR0ZWREb21haW4iLCJnZXRPcmlnaW4iLCJwdWJsaWNTZXJ2ZXJVUkwiLCJzZXJ2ZXJVUkwiLCJleHBvcnRzIiwiZXh0cmFjdFNpZ25lZENoYWxsZW5nZSIsInNpZ25lZENoYWxsZW5nZSIsIlBhcnNlIiwiRXJyb3IiLCJPVEhFUl9DQVVTRSIsImV4cGVjdGVkQ2hhbGxlbmdlIiwidmVyaWZ5IiwiY2hhbGxlbmdlIiwicmVnaXN0ZXJPcHRpb25zIiwidXNlciIsIm9wdGlvbnMiLCJyZWdpc3RyYXRpb25PcHRpb25zIiwiZ2VuZXJhdGVSZWdpc3RyYXRpb25PcHRpb25zIiwicnBOYW1lIiwicnBJRCIsInJwSWQiLCJ1c2VySUQiLCJpZCIsInVzZXJEaXNwbGF5TmFtZSIsImdldFVzZXJEaXNwbGF5TmFtZSIsImdldCIsInVzZXJOYW1lIiwiZ2V0VXNlcm5hbWUiLCJ0aW1lb3V0IiwiYXR0ZXN0YXRpb25UeXBlIiwiYXV0aGVudGljYXRvclNlbGVjdGlvbiIsInVzZXJWZXJpZmljYXRpb24iLCJyZXNpZGVudEtleSIsInNpZ24iLCJleHBpcmVzSW4iLCJ2ZXJpZnlSZWdpc3RlciIsInJlZ2lzdHJhdGlvbiIsInZlcmlmaWVkIiwicmVnaXN0cmF0aW9uSW5mbyIsInZlcmlmeVJlZ2lzdHJhdGlvblJlc3BvbnNlIiwicmVzcG9uc2UiLCJyZXF1aXJlVXNlclZlcmlmaWNhdGlvbiIsImV4cGVjdGVkT3JpZ2luIiwib3JpZ2luIiwiZXhwZWN0ZWRSUElEIiwiY291bnRlciIsInB1YmxpY0tleSIsImNyZWRlbnRpYWxQdWJsaWNLZXkiLCJsb2dpbk9wdGlvbnMiLCJnZW5lcmF0ZUF1dGhlbnRpY2F0aW9uT3B0aW9ucyIsInZlcmlmeUxvZ2luIiwiYXV0aGVudGljYXRpb24iLCJkYkF1dGhEYXRhIiwid2ViYXV0aG4iLCJhdXRoZW50aWNhdGlvbkluZm8iLCJ2ZXJpZnlBdXRoZW50aWNhdGlvblJlc3BvbnNlIiwiYXV0aGVudGljYXRvciIsImNyZWRlbnRpYWxJRCIsIkJ1ZmZlciIsImZyb20iLCJuZXdDb3VudGVyIiwiY2hhbGxlbmdlRGF0YSIsImF1dGhEYXRhIiwiYWRhcHRlckNvbmZpZyIsInJlcXVlc3QiLCJ2YWxpZGF0ZVNldFVwIiwibWFzdGVyIiwic2F2ZSIsInZhbGlkYXRlVXBkYXRlIiwidmFsaWRhdGVMb2dpbiIsIm9yaWdpbmFsIiwicG9saWN5Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL0FkYXB0ZXJzL0F1dGgvd2ViYXV0aG4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBXZWJBdXRobiBBZGFwdGVyIGNhbiBiZSB1c2VkIGFzIGFuIGFsdGVybmF0aXZlIHdheSB0byBsb2dpblxuICogU2luY2Ugd2UgY2Fubm90IHN1cHBvcnQgY3VycmVudGx5IHNpZ251cCB3aXRoIHdlYmF1dGhuIHdpbGwgdGhyb3cgYW4gZXJyb3IgKGR1ZSB0byBsYWNrIG9mIHJlc2V0IHByb2Nlc3MpXG4gKiBVc2VyIG5lZWQgdG8gYmUgbG9nZ2VkIGluIHRvIHNldHVwIHRoZSB3ZWJhdXRobiBwcm92aWRlclxuICovXG5pbXBvcnQge1xuICBnZW5lcmF0ZVJlZ2lzdHJhdGlvbk9wdGlvbnMsXG4gIHZlcmlmeVJlZ2lzdHJhdGlvblJlc3BvbnNlLFxuICBnZW5lcmF0ZUF1dGhlbnRpY2F0aW9uT3B0aW9ucyxcbiAgdmVyaWZ5QXV0aGVudGljYXRpb25SZXNwb25zZSxcbn0gZnJvbSAnQHNpbXBsZXdlYmF1dGhuL3NlcnZlcic7XG5pbXBvcnQgUGFyc2UgZnJvbSAncGFyc2Uvbm9kZSc7XG5pbXBvcnQgeyBzaWduLCB2ZXJpZnkgfSBmcm9tICdqc29ud2VidG9rZW4nO1xuaW1wb3J0IGNyeXB0byBmcm9tICdjcnlwdG8nO1xuXG5jb25zdCB0b1VzZXJGcmllbmRseVJwTmFtZSA9IHVybCA9PiB7XG4gIGNvbnN0IGRvbWFpbiA9IGdldERvbWFpbldpdGhvdXRXd3codXJsKTtcbiAgY29uc3QgYmFzZURvbWFpbiA9IGdldEJhc2VEb21haW4oZG9tYWluKS5zcGxpdCgnLicpWzBdO1xuICBjb25zdCB3b3JkcyA9IGJhc2VEb21haW4uc3BsaXQoJy0nKTtcbiAgcmV0dXJuIHdvcmRzXG4gICAgLnJlZHVjZSgoYWNjLCB3b3JkKSA9PiBgJHthY2N9ICR7d29yZC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHdvcmQuc2xpY2UoMSl9YCwgJycpXG4gICAgLnRyaW0oKTtcbn07XG5cbmNvbnN0IGdldEp3dFNlY3JldCA9IGNvbmZpZyA9PiB7XG4gIGNvbnN0IGhhc2ggPSBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhNTEyJyk7XG4gIGhhc2gudXBkYXRlKGNvbmZpZy5tYXN0ZXJLZXksICd1dGYtOCcpO1xuICAvLyBTZWN1cml0eTpcbiAgLy8gc2hhNTEyIHJldHVybiAxMjggY2hhcnMsIHdlIGNhbiBrZWVwIG9ubHkgNjQgY2hhcnMgc2luY2UgaXQgcmVwcmVzZW50IDYsNjFFOTggY29tYmluYXRpb25zXG4gIC8vIHVzaW5nIHRoZSBoYXNoIGFsbG93IHRvIHJlZHVjZSByaXNrIG9mIGNvbXByb21pc2luZyB0aGUgbWFzdGVyIGtleVxuICAvLyBpZiBicnV0ZSBmb3JjZSBpcyBhdHRlbXB0ZWQgb24gdGhlIEpXVFxuICByZXR1cm4gaGFzaC5kaWdlc3QoKS50b1N0cmluZygnaGV4Jykuc2xpY2UoNjQpO1xufTtcblxuLy8gRXhhbXBsZSBoZXJlOiBodHRwczovL3JlZ2V4MTAxLmNvbS9yL3dONmNaNy8zNjVcbmNvbnN0IGdldERvbWFpbldpdGhvdXRXd3cgPSB1cmwgPT5cbiAgL14oPzpodHRwcz86XFwvXFwvKT8oPzpbXkBcXC9cXG5dK0ApPyg/Ond3d1xcLik/KFteOlxcLz9cXG5dKykvZy5leGVjKHVybClbMV07XG5cbmNvbnN0IGdldEJhc2VEb21haW4gPSBkb21haW4gPT4ge1xuICBjb25zdCBzcGxpdHRlZERvbWFpbiA9IGRvbWFpbi5zcGxpdCgnLicpO1xuICAvLyBIYW5kbGUgbG9jYWxob3N0XG4gIGlmIChzcGxpdHRlZERvbWFpbi5sZW5ndGggPT09IDEpIHJldHVybiBkb21haW4udHJpbSgpO1xuICAvLyBDbGFzc2ljIGRvbWFpbnNcbiAgcmV0dXJuIGAke3NwbGl0dGVkRG9tYWluW3NwbGl0dGVkRG9tYWluLmxlbmd0aCAtIDJdfS4ke1xuICAgIHNwbGl0dGVkRG9tYWluW3NwbGl0dGVkRG9tYWluLmxlbmd0aCAtIDFdXG4gIH1gLnRyaW0oKTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRPcmlnaW4gPSBjb25maWcgPT5cbiAgZ2V0QmFzZURvbWFpbihnZXREb21haW5XaXRob3V0V3d3KGNvbmZpZy5wdWJsaWNTZXJ2ZXJVUkwgfHwgY29uZmlnLnNlcnZlclVSTCkpO1xuXG5jb25zdCBleHRyYWN0U2lnbmVkQ2hhbGxlbmdlID0gKHNpZ25lZENoYWxsZW5nZSwgY29uZmlnKSA9PiB7XG4gIGlmICghc2lnbmVkQ2hhbGxlbmdlKVxuICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihQYXJzZS5FcnJvci5PVEhFUl9DQVVTRSwgJ3NpZ25lZENoYWxsZW5nZSBpcyByZXF1aXJlZC4nKTtcbiAgbGV0IGV4cGVjdGVkQ2hhbGxlbmdlO1xuICB0cnkge1xuICAgIGV4cGVjdGVkQ2hhbGxlbmdlID0gdmVyaWZ5KHNpZ25lZENoYWxsZW5nZSwgZ2V0Snd0U2VjcmV0KGNvbmZpZykpLmNoYWxsZW5nZTtcbiAgICBpZiAoIWV4cGVjdGVkQ2hhbGxlbmdlKSB0aHJvdyBuZXcgRXJyb3IoKTtcbiAgICByZXR1cm4gZXhwZWN0ZWRDaGFsbGVuZ2U7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuT1RIRVJfQ0FVU0UsICdJbnZhbGlkIHNpZ25lZENoYWxsZW5nZScpO1xuICB9XG59O1xuXG4vLyBSZXR1cm4gY3JlZGVudGlhbHMgb3B0aW9ucyB0byB0aGUgY2xpZW50XG4vLyBmb3IgcmVnaXN0ZXIgcHVibGljIGtleSBwcm9jZXNzXG5jb25zdCByZWdpc3Rlck9wdGlvbnMgPSAodXNlciwgb3B0aW9ucyA9IHt9LCBjb25maWcpID0+IHtcbiAgY29uc3QgcmVnaXN0cmF0aW9uT3B0aW9ucyA9IGdlbmVyYXRlUmVnaXN0cmF0aW9uT3B0aW9ucyh7XG4gICAgcnBOYW1lOlxuICAgICAgKG9wdGlvbnMgJiYgb3B0aW9ucy5ycE5hbWUpIHx8XG4gICAgICB0b1VzZXJGcmllbmRseVJwTmFtZShjb25maWcucHVibGljU2VydmVyVVJMIHx8IGNvbmZpZy5zZXJ2ZXJVUkwpLFxuICAgIHJwSUQ6IG9wdGlvbnMucnBJZCB8fCBnZXRPcmlnaW4oY29uZmlnKSxcbiAgICAvLyBoZXJlIHVzZXJJZCBpcyBvbmx5IHVzZWQgYXMgYW4gaWRlbnRpZmllciBhbmQgdGhpcyBpcyBuZXZlclxuICAgIC8vIHJldHJpZXZlZCBieSB0aGUgdXNlciBkZXZpY2VcbiAgICAvLyB0aGlzIGhhcyBub3QgcmVhbCB2YWx1ZSBmb3IgcGFyc2VcbiAgICB1c2VySUQ6IHVzZXIuaWQsXG4gICAgLy8gQ291bGQgYmUgYW4gZW1haWwgb3IgYSBmaXJzdG5hbWUgbGFzdG5hbWUgZGVwZW5kaW5nIG9mXG4gICAgLy8gdGhlIGRldmVsb3BlciB1c2FnZVxuICAgIHVzZXJEaXNwbGF5TmFtZTpcbiAgICAgIHR5cGVvZiBvcHRpb25zLmdldFVzZXJEaXNwbGF5TmFtZSA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICA/IG9wdGlvbnMuZ2V0VXNlckRpc3BsYXlOYW1lKHVzZXIpXG4gICAgICAgIDogdXNlci5nZXQoJ2VtYWlsJykgfHwgdXNlci5nZXQoJ3VzZXJuYW1lJyksXG4gICAgdXNlck5hbWU6XG4gICAgICB0eXBlb2Ygb3B0aW9ucy5nZXRVc2VybmFtZSA9PT0gJ2Z1bmN0aW9uJyA/IG9wdGlvbnMuZ2V0VXNlcm5hbWUodXNlcikgOiB1c2VyLmdldCgndXNlcm5hbWUnKSxcbiAgICB0aW1lb3V0OiA2MDAwMCxcbiAgICBhdHRlc3RhdGlvblR5cGU6IG9wdGlvbnMuYXR0ZXN0YXRpb25UeXBlIHx8ICdpbmRpcmVjdCcsXG4gICAgYXV0aGVudGljYXRvclNlbGVjdGlvbjoge1xuICAgICAgLy8gVXNlIHJlcXVpcmVkIHRvIGF2b2lkIHNpbGVudCBzaWduIHVwXG4gICAgICB1c2VyVmVyaWZpY2F0aW9uOiBvcHRpb25zLnVzZXJWZXJpZmljYXRpb24gfHwgJ3JlcXVpcmVkJyxcbiAgICAgIHJlc2lkZW50S2V5OiBvcHRpb25zLnJlc2lkZW50S2V5IHx8ICdwcmVmZXJyZWQnLFxuICAgIH0sXG4gIH0pO1xuICByZXR1cm4ge1xuICAgIC8vIFVzZSBqd3Qgc2lnbmVkIGNoYWxsZW5nZSB0byBhdm9pZCBzdG9yaW5nIGNoYWxsZW5nZSBpbiBEQlxuICAgIC8vIE1hc3RlciBrZXkgaXMgY29uc2lkZXJlZCBzYWZlIGhlcmUgdG8gc2lnbiB0aGUgY2hhbGxlbmdlXG4gICAgLy8gQWRkIGFkZGl0aW9uYWwgMjBzZWMgZm9yIGEgYmFkIG5ldHdvcmsgbGF0ZW5jeVxuICAgIHNpZ25lZENoYWxsZW5nZTogc2lnbih7IGNoYWxsZW5nZTogcmVnaXN0cmF0aW9uT3B0aW9ucy5jaGFsbGVuZ2UgfSwgZ2V0Snd0U2VjcmV0KGNvbmZpZyksIHtcbiAgICAgIGV4cGlyZXNJbjogcmVnaXN0cmF0aW9uT3B0aW9ucy50aW1lb3V0ICsgMjAwMDAsXG4gICAgfSksXG4gICAgb3B0aW9uczogcmVnaXN0cmF0aW9uT3B0aW9ucyxcbiAgfTtcbn07XG5cbi8vIFZlcmlmeSB0aGUgcmVnaXN0cmF0aW9uIHByb3ZpZGVkIGJ5IHRoZSBjbGllbnRcbmNvbnN0IHZlcmlmeVJlZ2lzdGVyID0gYXN5bmMgKHsgc2lnbmVkQ2hhbGxlbmdlLCByZWdpc3RyYXRpb24gfSwgb3B0aW9ucyA9IHt9LCBjb25maWcpID0+IHtcbiAgaWYgKCFyZWdpc3RyYXRpb24pIHRocm93IG5ldyBQYXJzZS5FcnJvcihQYXJzZS5FcnJvci5PVEhFUl9DQVVTRSwgJ3JlZ2lzdHJhdGlvbiBpcyByZXF1aXJlZC4nKTtcbiAgY29uc3QgZXhwZWN0ZWRDaGFsbGVuZ2UgPSBleHRyYWN0U2lnbmVkQ2hhbGxlbmdlKHNpZ25lZENoYWxsZW5nZSwgY29uZmlnKTtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHZlcmlmaWVkLCByZWdpc3RyYXRpb25JbmZvIH0gPSBhd2FpdCB2ZXJpZnlSZWdpc3RyYXRpb25SZXNwb25zZSh7XG4gICAgICByZXNwb25zZTogcmVnaXN0cmF0aW9uLFxuICAgICAgZXhwZWN0ZWRDaGFsbGVuZ2UsXG4gICAgICByZXF1aXJlVXNlclZlcmlmaWNhdGlvbjpcbiAgICAgICAgb3B0aW9ucy51c2VyVmVyaWZpY2F0aW9uID09PSAncmVxdWlyZWQnIHx8ICFvcHRpb25zLnVzZXJWZXJpZmljYXRpb24gPyB0cnVlIDogZmFsc2UsXG4gICAgICBleHBlY3RlZE9yaWdpbjogb3B0aW9ucy5vcmlnaW4gfHwgZ2V0T3JpZ2luKGNvbmZpZyksXG4gICAgICBleHBlY3RlZFJQSUQ6IG9wdGlvbnMucnBJZCB8fCBnZXRPcmlnaW4oY29uZmlnKSxcbiAgICB9KTtcbiAgICBpZiAodmVyaWZpZWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvdW50ZXI6IHJlZ2lzdHJhdGlvbkluZm8uY291bnRlcixcbiAgICAgICAgcHVibGljS2V5OiByZWdpc3RyYXRpb25JbmZvLmNyZWRlbnRpYWxQdWJsaWNLZXkudG9TdHJpbmcoJ2Jhc2U2NCcpLFxuICAgICAgICBpZDogcmVnaXN0cmF0aW9uLmlkLFxuICAgICAgfTtcbiAgICB9XG4gICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQ6IGZhaWwgc2FmZSAqL1xuICAgIHRocm93IG5ldyBFcnJvcigpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLk9USEVSX0NBVVNFLCAnSW52YWxpZCB3ZWJhdXRobiByZWdpc3RyYXRpb24nKTtcbiAgfVxufTtcblxuY29uc3QgbG9naW5PcHRpb25zID0gY29uZmlnID0+IHtcbiAgY29uc3Qgb3B0aW9ucyA9IGdlbmVyYXRlQXV0aGVudGljYXRpb25PcHRpb25zKCk7XG4gIHJldHVybiB7XG4gICAgb3B0aW9ucyxcbiAgICBzaWduZWRDaGFsbGVuZ2U6IHNpZ24oeyBjaGFsbGVuZ2U6IG9wdGlvbnMuY2hhbGxlbmdlIH0sIGdldEp3dFNlY3JldChjb25maWcpLCB7XG4gICAgICBleHBpcmVzSW46IG9wdGlvbnMudGltZW91dCArIDIwMDAwLFxuICAgIH0pLFxuICB9O1xufTtcblxuY29uc3QgdmVyaWZ5TG9naW4gPSBhc3luYyAoeyBhdXRoZW50aWNhdGlvbiwgc2lnbmVkQ2hhbGxlbmdlIH0sIG9wdGlvbnMgPSB7fSwgY29uZmlnLCB1c2VyKSA9PiB7XG4gIGNvbnN0IGRiQXV0aERhdGEgPSB1c2VyICYmIHVzZXIuZ2V0KCdhdXRoRGF0YScpICYmIHVzZXIuZ2V0KCdhdXRoRGF0YScpLndlYmF1dGhuO1xuICBpZiAoIWF1dGhlbnRpY2F0aW9uKVxuICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihQYXJzZS5FcnJvci5PVEhFUl9DQVVTRSwgJ2F1dGhlbnRpY2F0aW9uIGlzIHJlcXVpcmVkLicpO1xuICBjb25zdCBleHBlY3RlZENoYWxsZW5nZSA9IGV4dHJhY3RTaWduZWRDaGFsbGVuZ2Uoc2lnbmVkQ2hhbGxlbmdlLCBjb25maWcpO1xuICB0cnkge1xuICAgIGNvbnN0IHsgdmVyaWZpZWQsIGF1dGhlbnRpY2F0aW9uSW5mbyB9ID0gYXdhaXQgdmVyaWZ5QXV0aGVudGljYXRpb25SZXNwb25zZSh7XG4gICAgICByZXNwb25zZTogYXV0aGVudGljYXRpb24sXG4gICAgICByZXF1aXJlVXNlclZlcmlmaWNhdGlvbjpcbiAgICAgICAgb3B0aW9ucy51c2VyVmVyaWZpY2F0aW9uID09PSAncmVxdWlyZWQnIHx8ICFvcHRpb25zLnVzZXJWZXJpZmljYXRpb24gPyB0cnVlIDogZmFsc2UsXG4gICAgICBleHBlY3RlZENoYWxsZW5nZSxcbiAgICAgIGV4cGVjdGVkT3JpZ2luOiBvcHRpb25zLm9yaWdpbiB8fCBnZXRPcmlnaW4oY29uZmlnKSxcbiAgICAgIGV4cGVjdGVkUlBJRDogb3B0aW9ucy5ycElkIHx8IGdldE9yaWdpbihjb25maWcpLFxuICAgICAgYXV0aGVudGljYXRvcjoge1xuICAgICAgICBjcmVkZW50aWFsSUQ6IEJ1ZmZlci5mcm9tKGRiQXV0aERhdGEuaWQsICdiYXNlNjQnKSxcbiAgICAgICAgY291bnRlcjogZGJBdXRoRGF0YS5jb3VudGVyLFxuICAgICAgICBjcmVkZW50aWFsUHVibGljS2V5OiBCdWZmZXIuZnJvbShkYkF1dGhEYXRhLnB1YmxpY0tleSwgJ2Jhc2U2NCcpLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBpZiAodmVyaWZpZWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmRiQXV0aERhdGEsXG4gICAgICAgIGNvdW50ZXI6IGF1dGhlbnRpY2F0aW9uSW5mby5uZXdDb3VudGVyLFxuICAgICAgfTtcbiAgICB9XG4gICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQ6IGZhaWwgc2FmZSAqL1xuICAgIHRocm93IG5ldyBFcnJvcigpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLk9USEVSX0NBVVNFLCAnSW52YWxpZCB3ZWJhdXRobiBhdXRoZW50aWNhdGlvbicpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgY2hhbGxlbmdlID0gYXN5bmMgKGNoYWxsZW5nZURhdGEsIGF1dGhEYXRhLCBhZGFwdGVyQ29uZmlnID0ge30sIHJlcXVlc3QpID0+IHtcbiAgLy8gQWxsb3cgbG9nZ2VkIHVzZXIgdG8gdXBkYXRlL3NldFVwIHdlYmF1dGhuXG4gIGlmIChyZXF1ZXN0LnVzZXIgJiYgcmVxdWVzdC51c2VyLmlkKSB7XG4gICAgcmV0dXJuIHJlZ2lzdGVyT3B0aW9ucyhyZXF1ZXN0LnVzZXIsIGFkYXB0ZXJDb25maWcub3B0aW9ucywgcmVxdWVzdC5jb25maWcpO1xuICB9XG5cbiAgcmV0dXJuIGxvZ2luT3B0aW9ucyhyZXF1ZXN0LmNvbmZpZyk7XG59O1xuXG5leHBvcnQgY29uc3QgdmFsaWRhdGVTZXRVcCA9IGFzeW5jIChhdXRoRGF0YSwgYWRhcHRlckNvbmZpZyA9IHt9LCByZXF1ZXN0KSA9PiB7XG4gIGlmICghcmVxdWVzdC51c2VyICYmICFyZXF1ZXN0Lm1hc3RlcilcbiAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoXG4gICAgICBQYXJzZS5FcnJvci5PVEhFUl9DQVVTRSxcbiAgICAgICdXZWJhdXRobiBjYW4gb25seSBiZSBjb25maWd1cmVkIG9uIGFuIGFscmVhZHkgbG9nZ2VkIGluIHVzZXIuJ1xuICAgICk7XG4gIHJldHVybiB7IHNhdmU6IGF3YWl0IHZlcmlmeVJlZ2lzdGVyKGF1dGhEYXRhLCBhZGFwdGVyQ29uZmlnLm9wdGlvbnMsIHJlcXVlc3QuY29uZmlnKSB9O1xufTtcblxuZXhwb3J0IGNvbnN0IHZhbGlkYXRlVXBkYXRlID0gdmFsaWRhdGVTZXRVcDtcblxuZXhwb3J0IGNvbnN0IHZhbGlkYXRlTG9naW4gPSBhc3luYyAoYXV0aERhdGEsIGFkYXB0ZXJDb25maWcgPSB7fSwgcmVxdWVzdCkgPT4ge1xuICBpZiAoIXJlcXVlc3Qub3JpZ2luYWwpXG4gICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLk9USEVSX0NBVVNFLCAnVXNlciBub3QgZm91bmQgZm9yIHdlYmF1dGhuIGxvZ2luLicpO1xuICAvLyBXaWxsIHNhdmUgdXBkYXRlZCBjb3VudGVyIG9mIHRoZSBjcmVkZW50aWFsXG4gIC8vIGFuZCBhdm9pZCBjbG9uZWQvYnVnZ2VkIGF1dGhlbnRpY2F0b3JzXG4gIHJldHVybiB7XG4gICAgc2F2ZTogYXdhaXQgdmVyaWZ5TG9naW4oYXV0aERhdGEsIGFkYXB0ZXJDb25maWcub3B0aW9ucywgcmVxdWVzdC5jb25maWcsIHJlcXVlc3Qub3JpZ2luYWwpLFxuICB9O1xufTtcblxuZXhwb3J0IGNvbnN0IHBvbGljeSA9ICdzb2xvJztcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBS0EsSUFBQUEsT0FBQSxHQUFBQyxPQUFBO0FBTUEsSUFBQUMsS0FBQSxHQUFBQyxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUcsYUFBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksT0FBQSxHQUFBRixzQkFBQSxDQUFBRixPQUFBO0FBQTRCLFNBQUFFLHVCQUFBRyxHQUFBLFdBQUFBLEdBQUEsSUFBQUEsR0FBQSxDQUFBQyxVQUFBLEdBQUFELEdBQUEsS0FBQUUsT0FBQSxFQUFBRixHQUFBO0FBQUEsU0FBQUcsUUFBQUMsQ0FBQSxFQUFBQyxDQUFBLFFBQUFDLENBQUEsR0FBQUMsTUFBQSxDQUFBQyxJQUFBLENBQUFKLENBQUEsT0FBQUcsTUFBQSxDQUFBRSxxQkFBQSxRQUFBQyxDQUFBLEdBQUFILE1BQUEsQ0FBQUUscUJBQUEsQ0FBQUwsQ0FBQSxHQUFBQyxDQUFBLEtBQUFLLENBQUEsR0FBQUEsQ0FBQSxDQUFBQyxNQUFBLFdBQUFOLENBQUEsV0FBQUUsTUFBQSxDQUFBSyx3QkFBQSxDQUFBUixDQUFBLEVBQUFDLENBQUEsRUFBQVEsVUFBQSxPQUFBUCxDQUFBLENBQUFRLElBQUEsQ0FBQUMsS0FBQSxDQUFBVCxDQUFBLEVBQUFJLENBQUEsWUFBQUosQ0FBQTtBQUFBLFNBQUFVLGNBQUFaLENBQUEsYUFBQUMsQ0FBQSxNQUFBQSxDQUFBLEdBQUFZLFNBQUEsQ0FBQUMsTUFBQSxFQUFBYixDQUFBLFVBQUFDLENBQUEsV0FBQVcsU0FBQSxDQUFBWixDQUFBLElBQUFZLFNBQUEsQ0FBQVosQ0FBQSxRQUFBQSxDQUFBLE9BQUFGLE9BQUEsQ0FBQUksTUFBQSxDQUFBRCxDQUFBLE9BQUFhLE9BQUEsV0FBQWQsQ0FBQSxJQUFBZSxlQUFBLENBQUFoQixDQUFBLEVBQUFDLENBQUEsRUFBQUMsQ0FBQSxDQUFBRCxDQUFBLFNBQUFFLE1BQUEsQ0FBQWMseUJBQUEsR0FBQWQsTUFBQSxDQUFBZSxnQkFBQSxDQUFBbEIsQ0FBQSxFQUFBRyxNQUFBLENBQUFjLHlCQUFBLENBQUFmLENBQUEsS0FBQUgsT0FBQSxDQUFBSSxNQUFBLENBQUFELENBQUEsR0FBQWEsT0FBQSxXQUFBZCxDQUFBLElBQUFFLE1BQUEsQ0FBQWdCLGNBQUEsQ0FBQW5CLENBQUEsRUFBQUMsQ0FBQSxFQUFBRSxNQUFBLENBQUFLLHdCQUFBLENBQUFOLENBQUEsRUFBQUQsQ0FBQSxpQkFBQUQsQ0FBQTtBQUFBLFNBQUFnQixnQkFBQXBCLEdBQUEsRUFBQXdCLEdBQUEsRUFBQUMsS0FBQSxJQUFBRCxHQUFBLEdBQUFFLGNBQUEsQ0FBQUYsR0FBQSxPQUFBQSxHQUFBLElBQUF4QixHQUFBLElBQUFPLE1BQUEsQ0FBQWdCLGNBQUEsQ0FBQXZCLEdBQUEsRUFBQXdCLEdBQUEsSUFBQUMsS0FBQSxFQUFBQSxLQUFBLEVBQUFaLFVBQUEsUUFBQWMsWUFBQSxRQUFBQyxRQUFBLG9CQUFBNUIsR0FBQSxDQUFBd0IsR0FBQSxJQUFBQyxLQUFBLFdBQUF6QixHQUFBO0FBQUEsU0FBQTBCLGVBQUFwQixDQUFBLFFBQUF1QixDQUFBLEdBQUFDLFlBQUEsQ0FBQXhCLENBQUEsdUNBQUF1QixDQUFBLEdBQUFBLENBQUEsR0FBQUEsQ0FBQTtBQUFBLFNBQUFDLGFBQUF4QixDQUFBLEVBQUFELENBQUEsMkJBQUFDLENBQUEsS0FBQUEsQ0FBQSxTQUFBQSxDQUFBLE1BQUFGLENBQUEsR0FBQUUsQ0FBQSxDQUFBeUIsTUFBQSxDQUFBQyxXQUFBLGtCQUFBNUIsQ0FBQSxRQUFBeUIsQ0FBQSxHQUFBekIsQ0FBQSxDQUFBNkIsSUFBQSxDQUFBM0IsQ0FBQSxFQUFBRCxDQUFBLHVDQUFBd0IsQ0FBQSxTQUFBQSxDQUFBLFlBQUFLLFNBQUEseUVBQUE3QixDQUFBLEdBQUE4QixNQUFBLEdBQUFDLE1BQUEsRUFBQTlCLENBQUEsS0FiNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVdBLE1BQU0rQixvQkFBb0IsR0FBR0MsR0FBRyxJQUFJO0VBQ2xDLE1BQU1DLE1BQU0sR0FBR0MsbUJBQW1CLENBQUNGLEdBQUcsQ0FBQztFQUN2QyxNQUFNRyxVQUFVLEdBQUdDLGFBQWEsQ0FBQ0gsTUFBTSxDQUFDLENBQUNJLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7RUFDdEQsTUFBTUMsS0FBSyxHQUFHSCxVQUFVLENBQUNFLEtBQUssQ0FBQyxHQUFHLENBQUM7RUFDbkMsT0FBT0MsS0FBSyxDQUNUQyxNQUFNLENBQUMsQ0FBQ0MsR0FBRyxFQUFFQyxJQUFJLEtBQU0sR0FBRUQsR0FBSSxJQUFHQyxJQUFJLENBQUNDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLENBQUMsR0FBR0YsSUFBSSxDQUFDRyxLQUFLLENBQUMsQ0FBQyxDQUFFLEVBQUMsRUFBRSxFQUFFLENBQUMsQ0FDbkZDLElBQUksQ0FBQyxDQUFDO0FBQ1gsQ0FBQztBQUVELE1BQU1DLFlBQVksR0FBR0MsTUFBTSxJQUFJO0VBQzdCLE1BQU1DLElBQUksR0FBR0MsZUFBTSxDQUFDQyxVQUFVLENBQUMsUUFBUSxDQUFDO0VBQ3hDRixJQUFJLENBQUNHLE1BQU0sQ0FBQ0osTUFBTSxDQUFDSyxTQUFTLEVBQUUsT0FBTyxDQUFDO0VBQ3RDO0VBQ0E7RUFDQTtFQUNBO0VBQ0EsT0FBT0osSUFBSSxDQUFDSyxNQUFNLENBQUMsQ0FBQyxDQUFDQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUNWLEtBQUssQ0FBQyxFQUFFLENBQUM7QUFDaEQsQ0FBQzs7QUFFRDtBQUNBLE1BQU1WLG1CQUFtQixHQUFHRixHQUFHLElBQzdCLHlEQUF5RCxDQUFDdUIsSUFBSSxDQUFDdkIsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRXhFLE1BQU1JLGFBQWEsR0FBR0gsTUFBTSxJQUFJO0VBQzlCLE1BQU11QixjQUFjLEdBQUd2QixNQUFNLENBQUNJLEtBQUssQ0FBQyxHQUFHLENBQUM7RUFDeEM7RUFDQSxJQUFJbUIsY0FBYyxDQUFDNUMsTUFBTSxLQUFLLENBQUMsRUFBRSxPQUFPcUIsTUFBTSxDQUFDWSxJQUFJLENBQUMsQ0FBQztFQUNyRDtFQUNBLE9BQVEsR0FBRVcsY0FBYyxDQUFDQSxjQUFjLENBQUM1QyxNQUFNLEdBQUcsQ0FBQyxDQUFFLElBQ2xENEMsY0FBYyxDQUFDQSxjQUFjLENBQUM1QyxNQUFNLEdBQUcsQ0FBQyxDQUN6QyxFQUFDLENBQUNpQyxJQUFJLENBQUMsQ0FBQztBQUNYLENBQUM7QUFFTSxNQUFNWSxTQUFTLEdBQUdWLE1BQU0sSUFDN0JYLGFBQWEsQ0FBQ0YsbUJBQW1CLENBQUNhLE1BQU0sQ0FBQ1csZUFBZSxJQUFJWCxNQUFNLENBQUNZLFNBQVMsQ0FBQyxDQUFDO0FBQUNDLE9BQUEsQ0FBQUgsU0FBQSxHQUFBQSxTQUFBO0FBRWpGLE1BQU1JLHNCQUFzQixHQUFHQSxDQUFDQyxlQUFlLEVBQUVmLE1BQU0sS0FBSztFQUMxRCxJQUFJLENBQUNlLGVBQWUsRUFDbEIsTUFBTSxJQUFJQyxhQUFLLENBQUNDLEtBQUssQ0FBQ0QsYUFBSyxDQUFDQyxLQUFLLENBQUNDLFdBQVcsRUFBRSw4QkFBOEIsQ0FBQztFQUNoRixJQUFJQyxpQkFBaUI7RUFDckIsSUFBSTtJQUNGQSxpQkFBaUIsR0FBRyxJQUFBQyxvQkFBTSxFQUFDTCxlQUFlLEVBQUVoQixZQUFZLENBQUNDLE1BQU0sQ0FBQyxDQUFDLENBQUNxQixTQUFTO0lBQzNFLElBQUksQ0FBQ0YsaUJBQWlCLEVBQUUsTUFBTSxJQUFJRixLQUFLLENBQUMsQ0FBQztJQUN6QyxPQUFPRSxpQkFBaUI7RUFDMUIsQ0FBQyxDQUFDLE9BQU9wRSxDQUFDLEVBQUU7SUFDVixNQUFNLElBQUlpRSxhQUFLLENBQUNDLEtBQUssQ0FBQ0QsYUFBSyxDQUFDQyxLQUFLLENBQUNDLFdBQVcsRUFBRSx5QkFBeUIsQ0FBQztFQUMzRTtBQUNGLENBQUM7O0FBRUQ7QUFDQTtBQUNBLE1BQU1JLGVBQWUsR0FBR0EsQ0FBQ0MsSUFBSSxFQUFFQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLEVBQUV4QixNQUFNLEtBQUs7RUFDdEQsTUFBTXlCLG1CQUFtQixHQUFHLElBQUFDLG1DQUEyQixFQUFDO0lBQ3REQyxNQUFNLEVBQ0hILE9BQU8sSUFBSUEsT0FBTyxDQUFDRyxNQUFNLElBQzFCM0Msb0JBQW9CLENBQUNnQixNQUFNLENBQUNXLGVBQWUsSUFBSVgsTUFBTSxDQUFDWSxTQUFTLENBQUM7SUFDbEVnQixJQUFJLEVBQUVKLE9BQU8sQ0FBQ0ssSUFBSSxJQUFJbkIsU0FBUyxDQUFDVixNQUFNLENBQUM7SUFDdkM7SUFDQTtJQUNBO0lBQ0E4QixNQUFNLEVBQUVQLElBQUksQ0FBQ1EsRUFBRTtJQUNmO0lBQ0E7SUFDQUMsZUFBZSxFQUNiLE9BQU9SLE9BQU8sQ0FBQ1Msa0JBQWtCLEtBQUssVUFBVSxHQUM1Q1QsT0FBTyxDQUFDUyxrQkFBa0IsQ0FBQ1YsSUFBSSxDQUFDLEdBQ2hDQSxJQUFJLENBQUNXLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSVgsSUFBSSxDQUFDVyxHQUFHLENBQUMsVUFBVSxDQUFDO0lBQy9DQyxRQUFRLEVBQ04sT0FBT1gsT0FBTyxDQUFDWSxXQUFXLEtBQUssVUFBVSxHQUFHWixPQUFPLENBQUNZLFdBQVcsQ0FBQ2IsSUFBSSxDQUFDLEdBQUdBLElBQUksQ0FBQ1csR0FBRyxDQUFDLFVBQVUsQ0FBQztJQUM5RkcsT0FBTyxFQUFFLEtBQUs7SUFDZEMsZUFBZSxFQUFFZCxPQUFPLENBQUNjLGVBQWUsSUFBSSxVQUFVO0lBQ3REQyxzQkFBc0IsRUFBRTtNQUN0QjtNQUNBQyxnQkFBZ0IsRUFBRWhCLE9BQU8sQ0FBQ2dCLGdCQUFnQixJQUFJLFVBQVU7TUFDeERDLFdBQVcsRUFBRWpCLE9BQU8sQ0FBQ2lCLFdBQVcsSUFBSTtJQUN0QztFQUNGLENBQUMsQ0FBQztFQUNGLE9BQU87SUFDTDtJQUNBO0lBQ0E7SUFDQTFCLGVBQWUsRUFBRSxJQUFBMkIsa0JBQUksRUFBQztNQUFFckIsU0FBUyxFQUFFSSxtQkFBbUIsQ0FBQ0o7SUFBVSxDQUFDLEVBQUV0QixZQUFZLENBQUNDLE1BQU0sQ0FBQyxFQUFFO01BQ3hGMkMsU0FBUyxFQUFFbEIsbUJBQW1CLENBQUNZLE9BQU8sR0FBRztJQUMzQyxDQUFDLENBQUM7SUFDRmIsT0FBTyxFQUFFQztFQUNYLENBQUM7QUFDSCxDQUFDOztBQUVEO0FBQ0EsTUFBTW1CLGNBQWMsR0FBRyxNQUFBQSxDQUFPO0VBQUU3QixlQUFlO0VBQUU4QjtBQUFhLENBQUMsRUFBRXJCLE9BQU8sR0FBRyxDQUFDLENBQUMsRUFBRXhCLE1BQU0sS0FBSztFQUN4RixJQUFJLENBQUM2QyxZQUFZLEVBQUUsTUFBTSxJQUFJN0IsYUFBSyxDQUFDQyxLQUFLLENBQUNELGFBQUssQ0FBQ0MsS0FBSyxDQUFDQyxXQUFXLEVBQUUsMkJBQTJCLENBQUM7RUFDOUYsTUFBTUMsaUJBQWlCLEdBQUdMLHNCQUFzQixDQUFDQyxlQUFlLEVBQUVmLE1BQU0sQ0FBQztFQUN6RSxJQUFJO0lBQ0YsTUFBTTtNQUFFOEMsUUFBUTtNQUFFQztJQUFpQixDQUFDLEdBQUcsTUFBTSxJQUFBQyxrQ0FBMEIsRUFBQztNQUN0RUMsUUFBUSxFQUFFSixZQUFZO01BQ3RCMUIsaUJBQWlCO01BQ2pCK0IsdUJBQXVCLEVBQ3JCMUIsT0FBTyxDQUFDZ0IsZ0JBQWdCLEtBQUssVUFBVSxJQUFJLENBQUNoQixPQUFPLENBQUNnQixnQkFBZ0IsR0FBRyxJQUFJLEdBQUcsS0FBSztNQUNyRlcsY0FBYyxFQUFFM0IsT0FBTyxDQUFDNEIsTUFBTSxJQUFJMUMsU0FBUyxDQUFDVixNQUFNLENBQUM7TUFDbkRxRCxZQUFZLEVBQUU3QixPQUFPLENBQUNLLElBQUksSUFBSW5CLFNBQVMsQ0FBQ1YsTUFBTTtJQUNoRCxDQUFDLENBQUM7SUFDRixJQUFJOEMsUUFBUSxFQUFFO01BQ1osT0FBTztRQUNMUSxPQUFPLEVBQUVQLGdCQUFnQixDQUFDTyxPQUFPO1FBQ2pDQyxTQUFTLEVBQUVSLGdCQUFnQixDQUFDUyxtQkFBbUIsQ0FBQ2pELFFBQVEsQ0FBQyxRQUFRLENBQUM7UUFDbEV3QixFQUFFLEVBQUVjLFlBQVksQ0FBQ2Q7TUFDbkIsQ0FBQztJQUNIO0lBQ0E7SUFDQSxNQUFNLElBQUlkLEtBQUssQ0FBQyxDQUFDO0VBQ25CLENBQUMsQ0FBQyxPQUFPbEUsQ0FBQyxFQUFFO0lBQ1YsTUFBTSxJQUFJaUUsYUFBSyxDQUFDQyxLQUFLLENBQUNELGFBQUssQ0FBQ0MsS0FBSyxDQUFDQyxXQUFXLEVBQUUsK0JBQStCLENBQUM7RUFDakY7QUFDRixDQUFDO0FBRUQsTUFBTXVDLFlBQVksR0FBR3pELE1BQU0sSUFBSTtFQUM3QixNQUFNd0IsT0FBTyxHQUFHLElBQUFrQyxxQ0FBNkIsRUFBQyxDQUFDO0VBQy9DLE9BQU87SUFDTGxDLE9BQU87SUFDUFQsZUFBZSxFQUFFLElBQUEyQixrQkFBSSxFQUFDO01BQUVyQixTQUFTLEVBQUVHLE9BQU8sQ0FBQ0g7SUFBVSxDQUFDLEVBQUV0QixZQUFZLENBQUNDLE1BQU0sQ0FBQyxFQUFFO01BQzVFMkMsU0FBUyxFQUFFbkIsT0FBTyxDQUFDYSxPQUFPLEdBQUc7SUFDL0IsQ0FBQztFQUNILENBQUM7QUFDSCxDQUFDO0FBRUQsTUFBTXNCLFdBQVcsR0FBRyxNQUFBQSxDQUFPO0VBQUVDLGNBQWM7RUFBRTdDO0FBQWdCLENBQUMsRUFBRVMsT0FBTyxHQUFHLENBQUMsQ0FBQyxFQUFFeEIsTUFBTSxFQUFFdUIsSUFBSSxLQUFLO0VBQzdGLE1BQU1zQyxVQUFVLEdBQUd0QyxJQUFJLElBQUlBLElBQUksQ0FBQ1csR0FBRyxDQUFDLFVBQVUsQ0FBQyxJQUFJWCxJQUFJLENBQUNXLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQzRCLFFBQVE7RUFDaEYsSUFBSSxDQUFDRixjQUFjLEVBQ2pCLE1BQU0sSUFBSTVDLGFBQUssQ0FBQ0MsS0FBSyxDQUFDRCxhQUFLLENBQUNDLEtBQUssQ0FBQ0MsV0FBVyxFQUFFLDZCQUE2QixDQUFDO0VBQy9FLE1BQU1DLGlCQUFpQixHQUFHTCxzQkFBc0IsQ0FBQ0MsZUFBZSxFQUFFZixNQUFNLENBQUM7RUFDekUsSUFBSTtJQUNGLE1BQU07TUFBRThDLFFBQVE7TUFBRWlCO0lBQW1CLENBQUMsR0FBRyxNQUFNLElBQUFDLG9DQUE0QixFQUFDO01BQzFFZixRQUFRLEVBQUVXLGNBQWM7TUFDeEJWLHVCQUF1QixFQUNyQjFCLE9BQU8sQ0FBQ2dCLGdCQUFnQixLQUFLLFVBQVUsSUFBSSxDQUFDaEIsT0FBTyxDQUFDZ0IsZ0JBQWdCLEdBQUcsSUFBSSxHQUFHLEtBQUs7TUFDckZyQixpQkFBaUI7TUFDakJnQyxjQUFjLEVBQUUzQixPQUFPLENBQUM0QixNQUFNLElBQUkxQyxTQUFTLENBQUNWLE1BQU0sQ0FBQztNQUNuRHFELFlBQVksRUFBRTdCLE9BQU8sQ0FBQ0ssSUFBSSxJQUFJbkIsU0FBUyxDQUFDVixNQUFNLENBQUM7TUFDL0NpRSxhQUFhLEVBQUU7UUFDYkMsWUFBWSxFQUFFQyxNQUFNLENBQUNDLElBQUksQ0FBQ1AsVUFBVSxDQUFDOUIsRUFBRSxFQUFFLFFBQVEsQ0FBQztRQUNsRHVCLE9BQU8sRUFBRU8sVUFBVSxDQUFDUCxPQUFPO1FBQzNCRSxtQkFBbUIsRUFBRVcsTUFBTSxDQUFDQyxJQUFJLENBQUNQLFVBQVUsQ0FBQ04sU0FBUyxFQUFFLFFBQVE7TUFDakU7SUFDRixDQUFDLENBQUM7SUFDRixJQUFJVCxRQUFRLEVBQUU7TUFDWixPQUFBbkYsYUFBQSxDQUFBQSxhQUFBLEtBQ0trRyxVQUFVO1FBQ2JQLE9BQU8sRUFBRVMsa0JBQWtCLENBQUNNO01BQVU7SUFFMUM7SUFDQTtJQUNBLE1BQU0sSUFBSXBELEtBQUssQ0FBQyxDQUFDO0VBQ25CLENBQUMsQ0FBQyxPQUFPbEUsQ0FBQyxFQUFFO0lBQ1YsTUFBTSxJQUFJaUUsYUFBSyxDQUFDQyxLQUFLLENBQUNELGFBQUssQ0FBQ0MsS0FBSyxDQUFDQyxXQUFXLEVBQUUsaUNBQWlDLENBQUM7RUFDbkY7QUFDRixDQUFDO0FBRU0sTUFBTUcsU0FBUyxHQUFHLE1BQUFBLENBQU9pRCxhQUFhLEVBQUVDLFFBQVEsRUFBRUMsYUFBYSxHQUFHLENBQUMsQ0FBQyxFQUFFQyxPQUFPLEtBQUs7RUFDdkY7RUFDQSxJQUFJQSxPQUFPLENBQUNsRCxJQUFJLElBQUlrRCxPQUFPLENBQUNsRCxJQUFJLENBQUNRLEVBQUUsRUFBRTtJQUNuQyxPQUFPVCxlQUFlLENBQUNtRCxPQUFPLENBQUNsRCxJQUFJLEVBQUVpRCxhQUFhLENBQUNoRCxPQUFPLEVBQUVpRCxPQUFPLENBQUN6RSxNQUFNLENBQUM7RUFDN0U7RUFFQSxPQUFPeUQsWUFBWSxDQUFDZ0IsT0FBTyxDQUFDekUsTUFBTSxDQUFDO0FBQ3JDLENBQUM7QUFBQ2EsT0FBQSxDQUFBUSxTQUFBLEdBQUFBLFNBQUE7QUFFSyxNQUFNcUQsYUFBYSxHQUFHLE1BQUFBLENBQU9ILFFBQVEsRUFBRUMsYUFBYSxHQUFHLENBQUMsQ0FBQyxFQUFFQyxPQUFPLEtBQUs7RUFDNUUsSUFBSSxDQUFDQSxPQUFPLENBQUNsRCxJQUFJLElBQUksQ0FBQ2tELE9BQU8sQ0FBQ0UsTUFBTSxFQUNsQyxNQUFNLElBQUkzRCxhQUFLLENBQUNDLEtBQUssQ0FDbkJELGFBQUssQ0FBQ0MsS0FBSyxDQUFDQyxXQUFXLEVBQ3ZCLCtEQUNGLENBQUM7RUFDSCxPQUFPO0lBQUUwRCxJQUFJLEVBQUUsTUFBTWhDLGNBQWMsQ0FBQzJCLFFBQVEsRUFBRUMsYUFBYSxDQUFDaEQsT0FBTyxFQUFFaUQsT0FBTyxDQUFDekUsTUFBTTtFQUFFLENBQUM7QUFDeEYsQ0FBQztBQUFDYSxPQUFBLENBQUE2RCxhQUFBLEdBQUFBLGFBQUE7QUFFSyxNQUFNRyxjQUFjLEdBQUFoRSxPQUFBLENBQUFnRSxjQUFBLEdBQUdILGFBQWE7QUFFcEMsTUFBTUksYUFBYSxHQUFHLE1BQUFBLENBQU9QLFFBQVEsRUFBRUMsYUFBYSxHQUFHLENBQUMsQ0FBQyxFQUFFQyxPQUFPLEtBQUs7RUFDNUUsSUFBSSxDQUFDQSxPQUFPLENBQUNNLFFBQVEsRUFDbkIsTUFBTSxJQUFJL0QsYUFBSyxDQUFDQyxLQUFLLENBQUNELGFBQUssQ0FBQ0MsS0FBSyxDQUFDQyxXQUFXLEVBQUUsb0NBQW9DLENBQUM7RUFDdEY7RUFDQTtFQUNBLE9BQU87SUFDTDBELElBQUksRUFBRSxNQUFNakIsV0FBVyxDQUFDWSxRQUFRLEVBQUVDLGFBQWEsQ0FBQ2hELE9BQU8sRUFBRWlELE9BQU8sQ0FBQ3pFLE1BQU0sRUFBRXlFLE9BQU8sQ0FBQ00sUUFBUTtFQUMzRixDQUFDO0FBQ0gsQ0FBQztBQUFDbEUsT0FBQSxDQUFBaUUsYUFBQSxHQUFBQSxhQUFBO0FBRUssTUFBTUUsTUFBTSxHQUFBbkUsT0FBQSxDQUFBbUUsTUFBQSxHQUFHLE1BQU0iLCJpZ25vcmVMaXN0IjpbXX0=