"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.validateUpdate = exports.validateSetUp = exports.validateLogin = exports.policy = exports.getOrigin = exports.challenge = void 0;
var _server = require("@simplewebauthn/server");
var _node = _interopRequireDefault(require("parse/node"));
var _jsonwebtoken = require("jsonwebtoken");
var _crypto = _interopRequireDefault(require("crypto"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); } /**
 * WebAuthn Adapter can be used as an alternative way to login
 * Since we cannot support currently signup with webauthn will throw an error (due to lack of reset process)
 * User need to be logged in to setup the webauthn provider
 */
const toUserFriendlyRpName = url => {
  const domain = getDomainWithoutWww(url);
  const baseDomain = getBaseDomain(domain).split('.')[0];
  const words = baseDomain.split('-');
  return words.reduce((acc, word) => `${acc} ${word.charAt(0).toUpperCase() + word.slice(1)}`, '').trim();
};
const getJwtSecret = config => {
  const hash = _crypto.default.createHash('sha512');
  hash.update(config.masterKey, 'utf-8');
  // Security:
  // sha512 return 128 chars, we can keep only 64 chars since it represent 6,61E98 combinations
  // using the hash allow to reduce risk of compromising the master key
  // if brute force is attempted on the JWT
  return hash.digest().toString('hex').slice(64);
};

// Example here: https://regex101.com/r/wN6cZ7/365
const getDomainWithoutWww = url => /^(?:https?:\/\/)?(?:[^@\/\n]+@)?(?:www\.)?([^:\/?\n]+)/g.exec(url)[1];
const getBaseDomain = domain => {
  const splittedDomain = domain.split('.');
  // Handle localhost
  if (splittedDomain.length === 1) return domain.trim();
  // Classic domains
  return `${splittedDomain[splittedDomain.length - 2]}.${splittedDomain[splittedDomain.length - 1]}`.trim();
};
const getOrigin = config => getBaseDomain(getDomainWithoutWww(config.publicServerURL || config.serverURL));
exports.getOrigin = getOrigin;
const extractSignedChallenge = (signedChallenge, config) => {
  if (!signedChallenge) throw new _node.default.Error(_node.default.Error.OTHER_CAUSE, 'signedChallenge is required.');
  let expectedChallenge;
  try {
    expectedChallenge = (0, _jsonwebtoken.verify)(signedChallenge, getJwtSecret(config)).challenge;
    if (!expectedChallenge) throw new Error();
    return expectedChallenge;
  } catch (e) {
    throw new _node.default.Error(_node.default.Error.OTHER_CAUSE, 'Invalid signedChallenge');
  }
};

// Return credentials options to the client
// for register public key process
const registerOptions = (user, options = {}, config) => {
  const registrationOptions = (0, _server.generateRegistrationOptions)({
    rpName: options && options.rpName || toUserFriendlyRpName(config.publicServerURL || config.serverURL),
    rpID: options.rpId || getOrigin(config),
    // here userId is only used as an identifier and this is never
    // retrieved by the user device
    // this has not real value for parse
    userID: user.id,
    // Could be an email or a firstname lastname depending of
    // the developer usage
    userDisplayName: typeof options.getUserDisplayName === 'function' ? options.getUserDisplayName(user) : user.get('email') || user.get('username'),
    userName: typeof options.getUsername === 'function' ? options.getUsername(user) : user.get('username'),
    timeout: 60000,
    attestationType: options.attestationType || 'indirect',
    authenticatorSelection: {
      // Use required to avoid silent sign up
      userVerification: options.userVerification || 'required',
      residentKey: options.residentKey || 'preferred'
    }
  });
  return {
    // Use jwt signed challenge to avoid storing challenge in DB
    // Master key is considered safe here to sign the challenge
    // Add additional 20sec for a bad network latency
    signedChallenge: (0, _jsonwebtoken.sign)({
      challenge: registrationOptions.challenge
    }, getJwtSecret(config), {
      expiresIn: registrationOptions.timeout + 20000
    }),
    options: registrationOptions
  };
};

// Verify the registration provided by the client
const verifyRegister = async ({
  signedChallenge,
  registration
}, options = {}, config) => {
  if (!registration) throw new _node.default.Error(_node.default.Error.OTHER_CAUSE, 'registration is required.');
  const expectedChallenge = extractSignedChallenge(signedChallenge, config);
  try {
    const {
      verified,
      registrationInfo
    } = await (0, _server.verifyRegistrationResponse)({
      response: registration,
      expectedChallenge,
      requireUserVerification: options.userVerification === 'required' || !options.userVerification ? true : false,
      expectedOrigin: options.origin || getOrigin(config),
      expectedRPID: options.rpId || getOrigin(config)
    });
    if (verified) {
      return {
        counter: registrationInfo.counter,
        publicKey: registrationInfo.credentialPublicKey.toString('base64'),
        id: registration.id
      };
    }
    /* istanbul ignore next: fail safe */
    throw new Error();
  } catch (e) {
    throw new _node.default.Error(_node.default.Error.OTHER_CAUSE, 'Invalid webauthn registration');
  }
};
const loginOptions = config => {
  const options = (0, _server.generateAuthenticationOptions)();
  return {
    options,
    signedChallenge: (0, _jsonwebtoken.sign)({
      challenge: options.challenge
    }, getJwtSecret(config), {
      expiresIn: options.timeout + 20000
    })
  };
};
const verifyLogin = async ({
  authentication,
  signedChallenge
}, options = {}, config, user) => {
  const dbAuthData = user && user.get('authData') && user.get('authData').webauthn;
  if (!authentication) throw new _node.default.Error(_node.default.Error.OTHER_CAUSE, 'authentication is required.');
  const expectedChallenge = extractSignedChallenge(signedChallenge, config);
  try {
    const {
      verified,
      authenticationInfo
    } = await (0, _server.verifyAuthenticationResponse)({
      response: authentication,
      requireUserVerification: options.userVerification === 'required' || !options.userVerification ? true : false,
      expectedChallenge,
      expectedOrigin: options.origin || getOrigin(config),
      expectedRPID: options.rpId || getOrigin(config),
      authenticator: {
        credentialID: Buffer.from(dbAuthData.id, 'base64'),
        counter: dbAuthData.counter,
        credentialPublicKey: Buffer.from(dbAuthData.publicKey, 'base64')
      }
    });
    if (verified) {
      return _objectSpread(_objectSpread({}, dbAuthData), {}, {
        counter: authenticationInfo.newCounter
      });
    }
    /* istanbul ignore next: fail safe */
    throw new Error();
  } catch (e) {
    throw new _node.default.Error(_node.default.Error.OTHER_CAUSE, 'Invalid webauthn authentication');
  }
};
const challenge = async (challengeData, authData, adapterConfig = {}, request) => {
  // Allow logged user to update/setUp webauthn
  if (request.user && request.user.id) {
    return registerOptions(request.user, adapterConfig.options, request.config);
  }
  return loginOptions(request.config);
};
exports.challenge = challenge;
const validateSetUp = async (authData, adapterConfig = {}, request) => {
  if (!request.user && !request.master) throw new _node.default.Error(_node.default.Error.OTHER_CAUSE, 'Webauthn can only be configured on an already logged in user.');
  return {
    save: await verifyRegister(authData, adapterConfig.options, request.config)
  };
};
exports.validateSetUp = validateSetUp;
const validateUpdate = exports.validateUpdate = validateSetUp;
const validateLogin = async (authData, adapterConfig = {}, request) => {
  if (!request.original) throw new _node.default.Error(_node.default.Error.OTHER_CAUSE, 'User not found for webauthn login.');
  // Will save updated counter of the credential
  // and avoid cloned/bugged authenticators
  return {
    save: await verifyLogin(authData, adapterConfig.options, request.config, request.original)
  };
};
exports.validateLogin = validateLogin;
const policy = exports.policy = 'solo';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc2VydmVyIiwicmVxdWlyZSIsIl9ub2RlIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9qc29ud2VidG9rZW4iLCJfY3J5cHRvIiwiZSIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0Iiwib3duS2V5cyIsInIiLCJ0IiwiT2JqZWN0Iiwia2V5cyIsImdldE93blByb3BlcnR5U3ltYm9scyIsIm8iLCJmaWx0ZXIiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwicHVzaCIsImFwcGx5IiwiX29iamVjdFNwcmVhZCIsImFyZ3VtZW50cyIsImxlbmd0aCIsImZvckVhY2giLCJfZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIiwiZGVmaW5lUHJvcGVydGllcyIsImRlZmluZVByb3BlcnR5IiwiX3RvUHJvcGVydHlLZXkiLCJ2YWx1ZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiaSIsIl90b1ByaW1pdGl2ZSIsIlN5bWJvbCIsInRvUHJpbWl0aXZlIiwiY2FsbCIsIlR5cGVFcnJvciIsIlN0cmluZyIsIk51bWJlciIsInRvVXNlckZyaWVuZGx5UnBOYW1lIiwidXJsIiwiZG9tYWluIiwiZ2V0RG9tYWluV2l0aG91dFd3dyIsImJhc2VEb21haW4iLCJnZXRCYXNlRG9tYWluIiwic3BsaXQiLCJ3b3JkcyIsInJlZHVjZSIsImFjYyIsIndvcmQiLCJjaGFyQXQiLCJ0b1VwcGVyQ2FzZSIsInNsaWNlIiwidHJpbSIsImdldEp3dFNlY3JldCIsImNvbmZpZyIsImhhc2giLCJjcnlwdG8iLCJjcmVhdGVIYXNoIiwidXBkYXRlIiwibWFzdGVyS2V5IiwiZGlnZXN0IiwidG9TdHJpbmciLCJleGVjIiwic3BsaXR0ZWREb21haW4iLCJnZXRPcmlnaW4iLCJwdWJsaWNTZXJ2ZXJVUkwiLCJzZXJ2ZXJVUkwiLCJleHBvcnRzIiwiZXh0cmFjdFNpZ25lZENoYWxsZW5nZSIsInNpZ25lZENoYWxsZW5nZSIsIlBhcnNlIiwiRXJyb3IiLCJPVEhFUl9DQVVTRSIsImV4cGVjdGVkQ2hhbGxlbmdlIiwidmVyaWZ5IiwiY2hhbGxlbmdlIiwicmVnaXN0ZXJPcHRpb25zIiwidXNlciIsIm9wdGlvbnMiLCJyZWdpc3RyYXRpb25PcHRpb25zIiwiZ2VuZXJhdGVSZWdpc3RyYXRpb25PcHRpb25zIiwicnBOYW1lIiwicnBJRCIsInJwSWQiLCJ1c2VySUQiLCJpZCIsInVzZXJEaXNwbGF5TmFtZSIsImdldFVzZXJEaXNwbGF5TmFtZSIsImdldCIsInVzZXJOYW1lIiwiZ2V0VXNlcm5hbWUiLCJ0aW1lb3V0IiwiYXR0ZXN0YXRpb25UeXBlIiwiYXV0aGVudGljYXRvclNlbGVjdGlvbiIsInVzZXJWZXJpZmljYXRpb24iLCJyZXNpZGVudEtleSIsInNpZ24iLCJleHBpcmVzSW4iLCJ2ZXJpZnlSZWdpc3RlciIsInJlZ2lzdHJhdGlvbiIsInZlcmlmaWVkIiwicmVnaXN0cmF0aW9uSW5mbyIsInZlcmlmeVJlZ2lzdHJhdGlvblJlc3BvbnNlIiwicmVzcG9uc2UiLCJyZXF1aXJlVXNlclZlcmlmaWNhdGlvbiIsImV4cGVjdGVkT3JpZ2luIiwib3JpZ2luIiwiZXhwZWN0ZWRSUElEIiwiY291bnRlciIsInB1YmxpY0tleSIsImNyZWRlbnRpYWxQdWJsaWNLZXkiLCJsb2dpbk9wdGlvbnMiLCJnZW5lcmF0ZUF1dGhlbnRpY2F0aW9uT3B0aW9ucyIsInZlcmlmeUxvZ2luIiwiYXV0aGVudGljYXRpb24iLCJkYkF1dGhEYXRhIiwid2ViYXV0aG4iLCJhdXRoZW50aWNhdGlvbkluZm8iLCJ2ZXJpZnlBdXRoZW50aWNhdGlvblJlc3BvbnNlIiwiYXV0aGVudGljYXRvciIsImNyZWRlbnRpYWxJRCIsIkJ1ZmZlciIsImZyb20iLCJuZXdDb3VudGVyIiwiY2hhbGxlbmdlRGF0YSIsImF1dGhEYXRhIiwiYWRhcHRlckNvbmZpZyIsInJlcXVlc3QiLCJ2YWxpZGF0ZVNldFVwIiwibWFzdGVyIiwic2F2ZSIsInZhbGlkYXRlVXBkYXRlIiwidmFsaWRhdGVMb2dpbiIsIm9yaWdpbmFsIiwicG9saWN5Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL0FkYXB0ZXJzL0F1dGgvd2ViYXV0aG4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBXZWJBdXRobiBBZGFwdGVyIGNhbiBiZSB1c2VkIGFzIGFuIGFsdGVybmF0aXZlIHdheSB0byBsb2dpblxuICogU2luY2Ugd2UgY2Fubm90IHN1cHBvcnQgY3VycmVudGx5IHNpZ251cCB3aXRoIHdlYmF1dGhuIHdpbGwgdGhyb3cgYW4gZXJyb3IgKGR1ZSB0byBsYWNrIG9mIHJlc2V0IHByb2Nlc3MpXG4gKiBVc2VyIG5lZWQgdG8gYmUgbG9nZ2VkIGluIHRvIHNldHVwIHRoZSB3ZWJhdXRobiBwcm92aWRlclxuICovXG5pbXBvcnQge1xuICBnZW5lcmF0ZVJlZ2lzdHJhdGlvbk9wdGlvbnMsXG4gIHZlcmlmeVJlZ2lzdHJhdGlvblJlc3BvbnNlLFxuICBnZW5lcmF0ZUF1dGhlbnRpY2F0aW9uT3B0aW9ucyxcbiAgdmVyaWZ5QXV0aGVudGljYXRpb25SZXNwb25zZSxcbn0gZnJvbSAnQHNpbXBsZXdlYmF1dGhuL3NlcnZlcic7XG5pbXBvcnQgUGFyc2UgZnJvbSAncGFyc2Uvbm9kZSc7XG5pbXBvcnQgeyBzaWduLCB2ZXJpZnkgfSBmcm9tICdqc29ud2VidG9rZW4nO1xuaW1wb3J0IGNyeXB0byBmcm9tICdjcnlwdG8nO1xuXG5jb25zdCB0b1VzZXJGcmllbmRseVJwTmFtZSA9IHVybCA9PiB7XG4gIGNvbnN0IGRvbWFpbiA9IGdldERvbWFpbldpdGhvdXRXd3codXJsKTtcbiAgY29uc3QgYmFzZURvbWFpbiA9IGdldEJhc2VEb21haW4oZG9tYWluKS5zcGxpdCgnLicpWzBdO1xuICBjb25zdCB3b3JkcyA9IGJhc2VEb21haW4uc3BsaXQoJy0nKTtcbiAgcmV0dXJuIHdvcmRzXG4gICAgLnJlZHVjZSgoYWNjLCB3b3JkKSA9PiBgJHthY2N9ICR7d29yZC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHdvcmQuc2xpY2UoMSl9YCwgJycpXG4gICAgLnRyaW0oKTtcbn07XG5cbmNvbnN0IGdldEp3dFNlY3JldCA9IGNvbmZpZyA9PiB7XG4gIGNvbnN0IGhhc2ggPSBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhNTEyJyk7XG4gIGhhc2gudXBkYXRlKGNvbmZpZy5tYXN0ZXJLZXksICd1dGYtOCcpO1xuICAvLyBTZWN1cml0eTpcbiAgLy8gc2hhNTEyIHJldHVybiAxMjggY2hhcnMsIHdlIGNhbiBrZWVwIG9ubHkgNjQgY2hhcnMgc2luY2UgaXQgcmVwcmVzZW50IDYsNjFFOTggY29tYmluYXRpb25zXG4gIC8vIHVzaW5nIHRoZSBoYXNoIGFsbG93IHRvIHJlZHVjZSByaXNrIG9mIGNvbXByb21pc2luZyB0aGUgbWFzdGVyIGtleVxuICAvLyBpZiBicnV0ZSBmb3JjZSBpcyBhdHRlbXB0ZWQgb24gdGhlIEpXVFxuICByZXR1cm4gaGFzaC5kaWdlc3QoKS50b1N0cmluZygnaGV4Jykuc2xpY2UoNjQpO1xufTtcblxuLy8gRXhhbXBsZSBoZXJlOiBodHRwczovL3JlZ2V4MTAxLmNvbS9yL3dONmNaNy8zNjVcbmNvbnN0IGdldERvbWFpbldpdGhvdXRXd3cgPSB1cmwgPT5cbiAgL14oPzpodHRwcz86XFwvXFwvKT8oPzpbXkBcXC9cXG5dK0ApPyg/Ond3d1xcLik/KFteOlxcLz9cXG5dKykvZy5leGVjKHVybClbMV07XG5cbmNvbnN0IGdldEJhc2VEb21haW4gPSBkb21haW4gPT4ge1xuICBjb25zdCBzcGxpdHRlZERvbWFpbiA9IGRvbWFpbi5zcGxpdCgnLicpO1xuICAvLyBIYW5kbGUgbG9jYWxob3N0XG4gIGlmIChzcGxpdHRlZERvbWFpbi5sZW5ndGggPT09IDEpIHJldHVybiBkb21haW4udHJpbSgpO1xuICAvLyBDbGFzc2ljIGRvbWFpbnNcbiAgcmV0dXJuIGAke3NwbGl0dGVkRG9tYWluW3NwbGl0dGVkRG9tYWluLmxlbmd0aCAtIDJdfS4ke1xuICAgIHNwbGl0dGVkRG9tYWluW3NwbGl0dGVkRG9tYWluLmxlbmd0aCAtIDFdXG4gIH1gLnRyaW0oKTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRPcmlnaW4gPSBjb25maWcgPT5cbiAgZ2V0QmFzZURvbWFpbihnZXREb21haW5XaXRob3V0V3d3KGNvbmZpZy5wdWJsaWNTZXJ2ZXJVUkwgfHwgY29uZmlnLnNlcnZlclVSTCkpO1xuXG5jb25zdCBleHRyYWN0U2lnbmVkQ2hhbGxlbmdlID0gKHNpZ25lZENoYWxsZW5nZSwgY29uZmlnKSA9PiB7XG4gIGlmICghc2lnbmVkQ2hhbGxlbmdlKVxuICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihQYXJzZS5FcnJvci5PVEhFUl9DQVVTRSwgJ3NpZ25lZENoYWxsZW5nZSBpcyByZXF1aXJlZC4nKTtcbiAgbGV0IGV4cGVjdGVkQ2hhbGxlbmdlO1xuICB0cnkge1xuICAgIGV4cGVjdGVkQ2hhbGxlbmdlID0gdmVyaWZ5KHNpZ25lZENoYWxsZW5nZSwgZ2V0Snd0U2VjcmV0KGNvbmZpZykpLmNoYWxsZW5nZTtcbiAgICBpZiAoIWV4cGVjdGVkQ2hhbGxlbmdlKSB0aHJvdyBuZXcgRXJyb3IoKTtcbiAgICByZXR1cm4gZXhwZWN0ZWRDaGFsbGVuZ2U7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuT1RIRVJfQ0FVU0UsICdJbnZhbGlkIHNpZ25lZENoYWxsZW5nZScpO1xuICB9XG59O1xuXG4vLyBSZXR1cm4gY3JlZGVudGlhbHMgb3B0aW9ucyB0byB0aGUgY2xpZW50XG4vLyBmb3IgcmVnaXN0ZXIgcHVibGljIGtleSBwcm9jZXNzXG5jb25zdCByZWdpc3Rlck9wdGlvbnMgPSAodXNlciwgb3B0aW9ucyA9IHt9LCBjb25maWcpID0+IHtcbiAgY29uc3QgcmVnaXN0cmF0aW9uT3B0aW9ucyA9IGdlbmVyYXRlUmVnaXN0cmF0aW9uT3B0aW9ucyh7XG4gICAgcnBOYW1lOlxuICAgICAgKG9wdGlvbnMgJiYgb3B0aW9ucy5ycE5hbWUpIHx8XG4gICAgICB0b1VzZXJGcmllbmRseVJwTmFtZShjb25maWcucHVibGljU2VydmVyVVJMIHx8IGNvbmZpZy5zZXJ2ZXJVUkwpLFxuICAgIHJwSUQ6IG9wdGlvbnMucnBJZCB8fCBnZXRPcmlnaW4oY29uZmlnKSxcbiAgICAvLyBoZXJlIHVzZXJJZCBpcyBvbmx5IHVzZWQgYXMgYW4gaWRlbnRpZmllciBhbmQgdGhpcyBpcyBuZXZlclxuICAgIC8vIHJldHJpZXZlZCBieSB0aGUgdXNlciBkZXZpY2VcbiAgICAvLyB0aGlzIGhhcyBub3QgcmVhbCB2YWx1ZSBmb3IgcGFyc2VcbiAgICB1c2VySUQ6IHVzZXIuaWQsXG4gICAgLy8gQ291bGQgYmUgYW4gZW1haWwgb3IgYSBmaXJzdG5hbWUgbGFzdG5hbWUgZGVwZW5kaW5nIG9mXG4gICAgLy8gdGhlIGRldmVsb3BlciB1c2FnZVxuICAgIHVzZXJEaXNwbGF5TmFtZTpcbiAgICAgIHR5cGVvZiBvcHRpb25zLmdldFVzZXJEaXNwbGF5TmFtZSA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICA/IG9wdGlvbnMuZ2V0VXNlckRpc3BsYXlOYW1lKHVzZXIpXG4gICAgICAgIDogdXNlci5nZXQoJ2VtYWlsJykgfHwgdXNlci5nZXQoJ3VzZXJuYW1lJyksXG4gICAgdXNlck5hbWU6XG4gICAgICB0eXBlb2Ygb3B0aW9ucy5nZXRVc2VybmFtZSA9PT0gJ2Z1bmN0aW9uJyA/IG9wdGlvbnMuZ2V0VXNlcm5hbWUodXNlcikgOiB1c2VyLmdldCgndXNlcm5hbWUnKSxcbiAgICB0aW1lb3V0OiA2MDAwMCxcbiAgICBhdHRlc3RhdGlvblR5cGU6IG9wdGlvbnMuYXR0ZXN0YXRpb25UeXBlIHx8ICdpbmRpcmVjdCcsXG4gICAgYXV0aGVudGljYXRvclNlbGVjdGlvbjoge1xuICAgICAgLy8gVXNlIHJlcXVpcmVkIHRvIGF2b2lkIHNpbGVudCBzaWduIHVwXG4gICAgICB1c2VyVmVyaWZpY2F0aW9uOiBvcHRpb25zLnVzZXJWZXJpZmljYXRpb24gfHwgJ3JlcXVpcmVkJyxcbiAgICAgIHJlc2lkZW50S2V5OiBvcHRpb25zLnJlc2lkZW50S2V5IHx8ICdwcmVmZXJyZWQnLFxuICAgIH0sXG4gIH0pO1xuICByZXR1cm4ge1xuICAgIC8vIFVzZSBqd3Qgc2lnbmVkIGNoYWxsZW5nZSB0byBhdm9pZCBzdG9yaW5nIGNoYWxsZW5nZSBpbiBEQlxuICAgIC8vIE1hc3RlciBrZXkgaXMgY29uc2lkZXJlZCBzYWZlIGhlcmUgdG8gc2lnbiB0aGUgY2hhbGxlbmdlXG4gICAgLy8gQWRkIGFkZGl0aW9uYWwgMjBzZWMgZm9yIGEgYmFkIG5ldHdvcmsgbGF0ZW5jeVxuICAgIHNpZ25lZENoYWxsZW5nZTogc2lnbih7IGNoYWxsZW5nZTogcmVnaXN0cmF0aW9uT3B0aW9ucy5jaGFsbGVuZ2UgfSwgZ2V0Snd0U2VjcmV0KGNvbmZpZyksIHtcbiAgICAgIGV4cGlyZXNJbjogcmVnaXN0cmF0aW9uT3B0aW9ucy50aW1lb3V0ICsgMjAwMDAsXG4gICAgfSksXG4gICAgb3B0aW9uczogcmVnaXN0cmF0aW9uT3B0aW9ucyxcbiAgfTtcbn07XG5cbi8vIFZlcmlmeSB0aGUgcmVnaXN0cmF0aW9uIHByb3ZpZGVkIGJ5IHRoZSBjbGllbnRcbmNvbnN0IHZlcmlmeVJlZ2lzdGVyID0gYXN5bmMgKHsgc2lnbmVkQ2hhbGxlbmdlLCByZWdpc3RyYXRpb24gfSwgb3B0aW9ucyA9IHt9LCBjb25maWcpID0+IHtcbiAgaWYgKCFyZWdpc3RyYXRpb24pIHRocm93IG5ldyBQYXJzZS5FcnJvcihQYXJzZS5FcnJvci5PVEhFUl9DQVVTRSwgJ3JlZ2lzdHJhdGlvbiBpcyByZXF1aXJlZC4nKTtcbiAgY29uc3QgZXhwZWN0ZWRDaGFsbGVuZ2UgPSBleHRyYWN0U2lnbmVkQ2hhbGxlbmdlKHNpZ25lZENoYWxsZW5nZSwgY29uZmlnKTtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHZlcmlmaWVkLCByZWdpc3RyYXRpb25JbmZvIH0gPSBhd2FpdCB2ZXJpZnlSZWdpc3RyYXRpb25SZXNwb25zZSh7XG4gICAgICByZXNwb25zZTogcmVnaXN0cmF0aW9uLFxuICAgICAgZXhwZWN0ZWRDaGFsbGVuZ2UsXG4gICAgICByZXF1aXJlVXNlclZlcmlmaWNhdGlvbjpcbiAgICAgICAgb3B0aW9ucy51c2VyVmVyaWZpY2F0aW9uID09PSAncmVxdWlyZWQnIHx8ICFvcHRpb25zLnVzZXJWZXJpZmljYXRpb24gPyB0cnVlIDogZmFsc2UsXG4gICAgICBleHBlY3RlZE9yaWdpbjogb3B0aW9ucy5vcmlnaW4gfHwgZ2V0T3JpZ2luKGNvbmZpZyksXG4gICAgICBleHBlY3RlZFJQSUQ6IG9wdGlvbnMucnBJZCB8fCBnZXRPcmlnaW4oY29uZmlnKSxcbiAgICB9KTtcbiAgICBpZiAodmVyaWZpZWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvdW50ZXI6IHJlZ2lzdHJhdGlvbkluZm8uY291bnRlcixcbiAgICAgICAgcHVibGljS2V5OiByZWdpc3RyYXRpb25JbmZvLmNyZWRlbnRpYWxQdWJsaWNLZXkudG9TdHJpbmcoJ2Jhc2U2NCcpLFxuICAgICAgICBpZDogcmVnaXN0cmF0aW9uLmlkLFxuICAgICAgfTtcbiAgICB9XG4gICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQ6IGZhaWwgc2FmZSAqL1xuICAgIHRocm93IG5ldyBFcnJvcigpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLk9USEVSX0NBVVNFLCAnSW52YWxpZCB3ZWJhdXRobiByZWdpc3RyYXRpb24nKTtcbiAgfVxufTtcblxuY29uc3QgbG9naW5PcHRpb25zID0gY29uZmlnID0+IHtcbiAgY29uc3Qgb3B0aW9ucyA9IGdlbmVyYXRlQXV0aGVudGljYXRpb25PcHRpb25zKCk7XG4gIHJldHVybiB7XG4gICAgb3B0aW9ucyxcbiAgICBzaWduZWRDaGFsbGVuZ2U6IHNpZ24oeyBjaGFsbGVuZ2U6IG9wdGlvbnMuY2hhbGxlbmdlIH0sIGdldEp3dFNlY3JldChjb25maWcpLCB7XG4gICAgICBleHBpcmVzSW46IG9wdGlvbnMudGltZW91dCArIDIwMDAwLFxuICAgIH0pLFxuICB9O1xufTtcblxuY29uc3QgdmVyaWZ5TG9naW4gPSBhc3luYyAoeyBhdXRoZW50aWNhdGlvbiwgc2lnbmVkQ2hhbGxlbmdlIH0sIG9wdGlvbnMgPSB7fSwgY29uZmlnLCB1c2VyKSA9PiB7XG4gIGNvbnN0IGRiQXV0aERhdGEgPSB1c2VyICYmIHVzZXIuZ2V0KCdhdXRoRGF0YScpICYmIHVzZXIuZ2V0KCdhdXRoRGF0YScpLndlYmF1dGhuO1xuICBpZiAoIWF1dGhlbnRpY2F0aW9uKVxuICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihQYXJzZS5FcnJvci5PVEhFUl9DQVVTRSwgJ2F1dGhlbnRpY2F0aW9uIGlzIHJlcXVpcmVkLicpO1xuICBjb25zdCBleHBlY3RlZENoYWxsZW5nZSA9IGV4dHJhY3RTaWduZWRDaGFsbGVuZ2Uoc2lnbmVkQ2hhbGxlbmdlLCBjb25maWcpO1xuICB0cnkge1xuICAgIGNvbnN0IHsgdmVyaWZpZWQsIGF1dGhlbnRpY2F0aW9uSW5mbyB9ID0gYXdhaXQgdmVyaWZ5QXV0aGVudGljYXRpb25SZXNwb25zZSh7XG4gICAgICByZXNwb25zZTogYXV0aGVudGljYXRpb24sXG4gICAgICByZXF1aXJlVXNlclZlcmlmaWNhdGlvbjpcbiAgICAgICAgb3B0aW9ucy51c2VyVmVyaWZpY2F0aW9uID09PSAncmVxdWlyZWQnIHx8ICFvcHRpb25zLnVzZXJWZXJpZmljYXRpb24gPyB0cnVlIDogZmFsc2UsXG4gICAgICBleHBlY3RlZENoYWxsZW5nZSxcbiAgICAgIGV4cGVjdGVkT3JpZ2luOiBvcHRpb25zLm9yaWdpbiB8fCBnZXRPcmlnaW4oY29uZmlnKSxcbiAgICAgIGV4cGVjdGVkUlBJRDogb3B0aW9ucy5ycElkIHx8IGdldE9yaWdpbihjb25maWcpLFxuICAgICAgYXV0aGVudGljYXRvcjoge1xuICAgICAgICBjcmVkZW50aWFsSUQ6IEJ1ZmZlci5mcm9tKGRiQXV0aERhdGEuaWQsICdiYXNlNjQnKSxcbiAgICAgICAgY291bnRlcjogZGJBdXRoRGF0YS5jb3VudGVyLFxuICAgICAgICBjcmVkZW50aWFsUHVibGljS2V5OiBCdWZmZXIuZnJvbShkYkF1dGhEYXRhLnB1YmxpY0tleSwgJ2Jhc2U2NCcpLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBpZiAodmVyaWZpZWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmRiQXV0aERhdGEsXG4gICAgICAgIGNvdW50ZXI6IGF1dGhlbnRpY2F0aW9uSW5mby5uZXdDb3VudGVyLFxuICAgICAgfTtcbiAgICB9XG4gICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQ6IGZhaWwgc2FmZSAqL1xuICAgIHRocm93IG5ldyBFcnJvcigpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLk9USEVSX0NBVVNFLCAnSW52YWxpZCB3ZWJhdXRobiBhdXRoZW50aWNhdGlvbicpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgY2hhbGxlbmdlID0gYXN5bmMgKGNoYWxsZW5nZURhdGEsIGF1dGhEYXRhLCBhZGFwdGVyQ29uZmlnID0ge30sIHJlcXVlc3QpID0+IHtcbiAgLy8gQWxsb3cgbG9nZ2VkIHVzZXIgdG8gdXBkYXRlL3NldFVwIHdlYmF1dGhuXG4gIGlmIChyZXF1ZXN0LnVzZXIgJiYgcmVxdWVzdC51c2VyLmlkKSB7XG4gICAgcmV0dXJuIHJlZ2lzdGVyT3B0aW9ucyhyZXF1ZXN0LnVzZXIsIGFkYXB0ZXJDb25maWcub3B0aW9ucywgcmVxdWVzdC5jb25maWcpO1xuICB9XG5cbiAgcmV0dXJuIGxvZ2luT3B0aW9ucyhyZXF1ZXN0LmNvbmZpZyk7XG59O1xuXG5leHBvcnQgY29uc3QgdmFsaWRhdGVTZXRVcCA9IGFzeW5jIChhdXRoRGF0YSwgYWRhcHRlckNvbmZpZyA9IHt9LCByZXF1ZXN0KSA9PiB7XG4gIGlmICghcmVxdWVzdC51c2VyICYmICFyZXF1ZXN0Lm1hc3RlcilcbiAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoXG4gICAgICBQYXJzZS5FcnJvci5PVEhFUl9DQVVTRSxcbiAgICAgICdXZWJhdXRobiBjYW4gb25seSBiZSBjb25maWd1cmVkIG9uIGFuIGFscmVhZHkgbG9nZ2VkIGluIHVzZXIuJ1xuICAgICk7XG4gIHJldHVybiB7IHNhdmU6IGF3YWl0IHZlcmlmeVJlZ2lzdGVyKGF1dGhEYXRhLCBhZGFwdGVyQ29uZmlnLm9wdGlvbnMsIHJlcXVlc3QuY29uZmlnKSB9O1xufTtcblxuZXhwb3J0IGNvbnN0IHZhbGlkYXRlVXBkYXRlID0gdmFsaWRhdGVTZXRVcDtcblxuZXhwb3J0IGNvbnN0IHZhbGlkYXRlTG9naW4gPSBhc3luYyAoYXV0aERhdGEsIGFkYXB0ZXJDb25maWcgPSB7fSwgcmVxdWVzdCkgPT4ge1xuICBpZiAoIXJlcXVlc3Qub3JpZ2luYWwpXG4gICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLk9USEVSX0NBVVNFLCAnVXNlciBub3QgZm91bmQgZm9yIHdlYmF1dGhuIGxvZ2luLicpO1xuICAvLyBXaWxsIHNhdmUgdXBkYXRlZCBjb3VudGVyIG9mIHRoZSBjcmVkZW50aWFsXG4gIC8vIGFuZCBhdm9pZCBjbG9uZWQvYnVnZ2VkIGF1dGhlbnRpY2F0b3JzXG4gIHJldHVybiB7XG4gICAgc2F2ZTogYXdhaXQgdmVyaWZ5TG9naW4oYXV0aERhdGEsIGFkYXB0ZXJDb25maWcub3B0aW9ucywgcmVxdWVzdC5jb25maWcsIHJlcXVlc3Qub3JpZ2luYWwpLFxuICB9O1xufTtcblxuZXhwb3J0IGNvbnN0IHBvbGljeSA9ICdzb2xvJztcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBS0EsSUFBQUEsT0FBQSxHQUFBQyxPQUFBO0FBTUEsSUFBQUMsS0FBQSxHQUFBQyxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUcsYUFBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksT0FBQSxHQUFBRixzQkFBQSxDQUFBRixPQUFBO0FBQTRCLFNBQUFFLHVCQUFBRyxDQUFBLFdBQUFBLENBQUEsSUFBQUEsQ0FBQSxDQUFBQyxVQUFBLEdBQUFELENBQUEsS0FBQUUs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